<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Asesor de Admisiones 路 ISTHMUS</title>

  <!-- ChatKit runtime -->
  <script src="https://cdn.platform.openai.com/deployments/chatkit/chatkit.js" async></script>

  <!-- (Opcional) Verificaci贸n de dominio de ChatKit -->
  <meta name="chatkit:domain_public_key" content="domain_pk_68e7da3b8b38819099c41f6a597d5cdf00560b7a3fd09ef4" />

  <style>
    :root{
      --bg:#f6f8fb; --ink:#0b2b3c;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{
      background:var(--bg);
      color:var(--ink);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial;
    }

    /* Contenedor vac铆o (fondo limpio) */
    .page{
      min-height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
    }
    .hint{
      font-size:14px;
      opacity:.6;
      text-align:center;
      user-select:none;
    }

    /* Bot贸n flotante */
    #chat-launcher{
      position:fixed; right:20px; bottom:20px;
      width:56px; height:56px; border-radius:50%;
      border:none; cursor:pointer; z-index:9999;
      background:#111; color:#fff; font-size:22px; line-height:1;
      box-shadow:0 8px 24px rgba(0,0,0,.25);
    }
    #chat-launcher:focus{ outline:3px solid rgba(15,94,168,.4); outline-offset:2px; }

    /* Contenedor del chat */
    #chat-container{
      position:fixed; right:20px; bottom:88px;
      width:360px; height:600px; z-index:9998; display:none;
      background:#fff; border-radius:12px; overflow:hidden;
      box-shadow:0 16px 36px rgba(0,0,0,.28);
    }
    @media (max-width:480px){
      #chat-container{ right:0; left:0; bottom:0; width:100vw; height:70vh; border-radius:0; }
    }
  </style>
</head>
<body>

  <!-- Fondo limpio, sin contenido -->
  <div class="page">
    <div class="hint">Haz clic en el bot贸n  para abrir el chat de admisiones.</div>
  </div>

  <!-- Chat flotante -->
  <div id="chat-container" aria-hidden="true"></div>
  <button id="chat-launcher" aria-label="Abrir chat de admisiones" title="Chatear"></button>

  <script>
    (function(){
      // URL de tu API en Railway
      const SESSION_URL = "https://isthmus-production.up.railway.app/api/chatkit/session";

      // Persistimos un ID por dispositivo para la sesi贸n
      const KEY = "ck_device_id";
      let deviceId = localStorage.getItem(KEY);
      if(!deviceId){
        deviceId = (crypto && crypto.randomUUID) ? crypto.randomUUID() : String(Date.now()) + "-" + Math.random().toString(36).slice(2);
        localStorage.setItem(KEY, deviceId);
      }

      async function getClientSecret(){
        const r = await fetch(SESSION_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ userId: deviceId })
        });
        if(!r.ok){
          console.error("No se pudo crear la sesi贸n de ChatKit", r.status, await r.text().catch(()=>null));
          throw new Error("No se pudo crear la sesi贸n de ChatKit");
        }
        const { client_secret } = await r.json();
        return client_secret;
      }

      // Espera a que cargue el runtime global de ChatKit
      function whenReady(fn){
        if (window.ChatKit) return fn();
        setTimeout(()=>whenReady(fn), 60);
      }

      document.addEventListener("DOMContentLoaded", function(){
        const container = document.getElementById("chat-container");
        const fab = document.getElementById("chat-launcher");
        let mounted = false;
        let open = false;
        let instance = null;

        whenReady(function(){
          fab.addEventListener("click", async function(){
            if(!mounted){
              instance = window.ChatKit({
                api: { getClientSecret },
                className: "h-[600px] w-[360px]"
              });
              instance.mount(container);
              mounted = true;
            }
            open = !open;
            container.style.display = open ? "block" : "none";
            container.setAttribute("aria-hidden", String(!open));
          });
        });
      });
    })();
  </script>
</body>
</html>



