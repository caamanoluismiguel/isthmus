<!doctype html> <html lang="es"> <head> <meta charset="utf-8" /> <title>Isthmus · Demo ChatKit</title> <meta name="viewport" content="width=device-width, initial-scale=1" /> <!-- ChatKit runtime (CDN oficial) --> <script src="https://cdn.platform.openai.com/deployments/chatkit/chatkit.js" async></script> <!-- Verificación de dominio de ChatKit (tu domain_pk) --> <meta name="chatkit:domain_public_key" content="domain_pk_68e7da3b8b38819099c41f6a597d5cdf00560b7a3fd09ef4" /> <style> /* Botón flotante + contenedor */ #chat-launcher { position: fixed; right: 20px; bottom: 20px; width: 56px; height: 56px; border-radius: 50%; border: none; cursor: pointer; z-index: 9999; box-shadow: 0 6px 20px rgba(0,0,0,.2); background: #0f5ea8; color: #fff; font-size: 22px; } #chat-shell { position: fixed; right: 20px; bottom: 88px; width: 360px; height: 600px; z-index: 9998; display: none; background: #fff; border-radius: 12px; overflow: hidden; box-shadow: 0 12px 30px rgba(0,0,0,.25); } @media (max-width: 480px) { #chat-shell { width: 100vw; height: 70vh; right: 0; left: 0; bottom: 0; border-radius: 0; } } body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial; margin:0; } header { padding: 18px 20px; border-bottom: 1px solid #eef2f6; } main { padding: 20px; } </style> </head> <body> <!-- Tu página normal (puedes ampliarla luego) --> <header> <h1>Demo Isthmus</h1> <p>Esta es la landing de prueba. Abre el chat abajo a la derecha.</p> </header> <main> <p>Contenido de ejemplo…</p> </main> <!-- Contenedor del chat + botón --> <div id="chat-shell" aria-hidden="true"> <!-- Web component de ChatKit (se configura por JS con setOptions) --> <openai-chatkit id="isthmus-chat" class="h-[600px] w-[360px]"></openai-chatkit> </div> <button id="chat-launcher" aria-label="Abrir chat">💬</button> <script> // ⚠️ Ajusta esta URL a tu backend en Railway const SESSION_URL = "https://isthmus-production.up.railway.app/api/chatkit/session"; const deviceIdKey = "ck_device_id"; let deviceId = localStorage.getItem(deviceIdKey); if (!deviceId) { deviceId = (crypto && crypto.randomUUID) ? crypto.randomUUID() : String(Date.now()); localStorage.setItem(deviceIdKey, deviceId); } // Referencias DOM const shell = document.getElementById("chat-shell"); const el = document.getElementById("isthmus-chat"); const fab = document.getElementById("chat-launcher"); // Configuración del widget según docs: setOptions + api.getClientSecret // Docs: autenticación y opciones (getClientSecret + setOptions). :contentReference[oaicite:3]{index=3} async function getClientSecret(currentClientSecret) { // Puedes ignorar currentClientSecret y siempre pedir uno nuevo const res = await fetch(SESSION_URL, { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ userId: deviceId }) }); if (!res.ok) { const txt = await res.text().catch(() => ""); throw new Error("Fallo creando sesión (" + res.status + "): " + txt); } const { client_secret } = await res.json(); return client_secret; } // Opciones mínimas + UX de inicio. Claves válidas: startScreen.greeting y startScreen.prompts [{label, prompt, icon?}] // Referencias oficiales (prompts/greeting y uso de web component): :contentReference[oaicite:4]{index=4} function applyChatOptions() { el.setOptions({ api: { getClientSecret }, locale: "es", composer: { placeholder: "Pregúntame por programas, requisitos o agenda una visita…" }, startScreen: { greeting: "¡Hola! Soy el asesor virtual de Admisiones de ISTHMUS. ¿Cómo te llamas?", prompts: [ { label: "Conocer Arquitectura", prompt: "Quiero información del programa de Arquitectura." , icon: "search" }, { label: "Costos por correo", prompt: "Envíenme los costos por correo, por favor." , icon: "write" }, { label: "Agendar visita", prompt: "Quiero agendar una visita al campus." , icon: "calendar" } ] }, header: { enabled: true }, history: { enabled: true }, theme: { colorScheme: "light", color: { accent: { primary: "#0f5ea8", level: 2 } }, radius: "round", density: "normal", typography: { fontFamily: "Inter, system-ui, sans-serif" } } }); } // Toggle de apertura/cierre del chat let mounted = false; fab.onclick = () => { if (!mounted) { // Espera a que el script del CDN haya registrado el custom element if (!window.customElements || !customElements.get("openai-chatkit")) { console.warn("ChatKit aún no cargó; reintentando…"); } applyChatOptions(); mounted = true; } const show = shell.style.display !== "block"; shell.style.display = show ? "block" : "none"; shell.setAttribute("aria-hidden", String(!show)); }; // Opcional: abre con tecla "c" document.addEventListener("keydown", (e) => { if (e.key.toLowerCase() === "c") { fab.click(); } }); </script> </body> </html>
