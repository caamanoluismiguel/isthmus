<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Isthmus Â· Chat (fallback)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{ --fab:#0b5d3f; --shadow:0 12px 30px rgba(0,0,0,.25); --gap:20px; --size:56px; }
    *{ box-sizing:border-box } body{ margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial; background:#f6f8fb }
    header{ padding:20px; border-bottom:1px solid #eef2f6 } main{ padding:20px }

    #panel{ position:fixed; right:20px; bottom:calc(var(--gap) + var(--size) + 12px); width:360px; height:600px;
      display:none; background:#fff; border-radius:12px; box-shadow:var(--shadow); overflow:hidden; z-index:9998; }
    #fab{ position:fixed; right:var(--gap); bottom:var(--gap); width:var(--size); height:var(--size);
      border:none; border-radius:50%; background:var(--fab); color:#fff; font-size:22px; cursor:pointer; z-index:9999;
      display:inline-flex; align-items:center; justify-content:center; box-shadow:0 6px 20px rgba(0,0,0,.25); }
    #head{ padding:10px 12px; border-bottom:1px solid #eef2f6; display:flex; align-items:center; gap:8px }
    #close{ margin-left:auto; border:none; background:#0f172a; color:#fff; padding:8px 10px; border-radius:8px; cursor:pointer }

    #log{ padding:12px; height:calc(100% - 56px - 56px); overflow:auto; background:#f9fafb }
    .msg{ max-width:82%; padding:10px 12px; border-radius:14px; margin:8px 0; line-height:1.35 }
    .me{ background:#e6f3ec; margin-left:auto }
    .bot{ background:#fff; border:1px solid #e5e7eb }

    #composer{ display:flex; gap:8px; padding:10px; border-top:1px solid #eef2f6; background:#fff }
    #inp{ flex:1; padding:10px 12px; border:1px solid #e2e8f0; border-radius:10px; font:inherit }
    #send{ background:#0b5d3f; color:#fff; border:none; padding:10px 14px; border-radius:10px; cursor:pointer }

    @media (max-width:480px){
      #panel{ right:0; left:0; bottom:0; width:100vw; height:70vh; border-radius:12px 12px 0 0 }
      #fab{ bottom:28px }
    }
  </style>
</head>
<body>
  <header>
    <h1>Demo Isthmus</h1>
    <p>Chat conversacional de respaldo (sin dependencias de terceros en el navegador).</p>
  </header>
  <main><p>PregÃºntame por programas, costos por correo o agenda una visita.</p></main>

  <div id="panel" role="dialog" aria-modal="true">
    <div id="head">
      <strong>Asesor ISTHMUS</strong>
      <button id="close">Cerrar</button>
    </div>
    <div id="log"></div>
    <div id="composer">
      <input id="inp" placeholder="Escribe tu mensajeâ€¦" />
      <button id="send">Enviar</button>
    </div>
  </div>
  <button id="fab" aria-label="Abrir chat">ðŸ’¬</button>

  <script>
    const panel = document.getElementById("panel");
    const fab   = document.getElementById("fab");
    const close = document.getElementById("close");
    const log   = document.getElementById("log");
    const inp   = document.getElementById("inp");
    const send  = document.getElementById("send");

    function openPanel(){ panel.style.display="block"; inp.focus(); setTimeout(()=> { fab.style.display="none"; }, 0); }
    function closePanel(){ panel.style.display="none"; fab.style.display="inline-flex"; }

    function add(role, text){
      const div = document.createElement("div");
      div.className = "msg " + (role==="user" ? "me":"bot");
      div.textContent = text;
      log.appendChild(div);
      log.scrollTop = log.scrollHeight;
    }

    async function ask(text){
      add("user", text);
      inp.value = ""; send.disabled = true;
      try{
        const r = await fetch("/api/agent_chat", {
          method:"POST", headers:{ "Content-Type":"application/json" },
          body: JSON.stringify({ text })
        });
        const j = await r.json();
        add("assistant", j.reply || "Listo.");
      }catch(e){
        add("assistant", "Hubo un problema temporal. Intenta de nuevo o dÃ©jame tu correo y telÃ©fono para contactarte.");
      }finally{
        send.disabled = false; inp.focus();
      }
    }

    send.onclick = () => { const t = inp.value.trim(); if (t) ask(t); };
    inp.onkeydown = (e)=>{ if (e.key==="Enter" && !e.shiftKey){ e.preventDefault(); send.click(); } };
    fab.onclick = openPanel; close.onclick = closePanel;
  </script>
</body>
</html>







